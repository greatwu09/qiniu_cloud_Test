<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
	
    <link rel="shortcut icon" href="/images/favicon/favicon.png" type="image/x-icon">
    <link rel="icon" href="/images/favicon/favicon.png" type="image/x-icon">

    <title>TEAM Creative Agency Template</title>
	
    <!--Library Styles-->    
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/lib/font-awesome.css" rel="stylesheet">
    <link href="/css/lib/nivo-lightbox.css" rel="stylesheet">
    <link href="/css/lib/nivo-themes/default/default.css" rel="stylesheet">
	
    <!--Template Styles-->
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/scheme/purple.css" rel="stylesheet">

    <!-- move the scripts from body to head-->

    <!-- levarage original -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="/bootstrap-table/src/bootstrap-table.css">
    <link rel="stylesheet" href="/examples.css">
    <!--
    <script src="/jquery.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    -->

    <!-- Library Scripts -->

    <script src="/js/jquery-1.10.2.min.js"></script>

    <script src="/js/lib/smoothscroll.js"></script>
    <script src="/js/main.js"></script>
    <script src="/jquery.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>

    <!------------------------------------------------->
    <script src="/js/lib/jquery.preloader.js"></script>
    <script src="/js/lib/nivo-lightbox.min.js"></script>
    <!--
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/lib/jquery.superslides.min.js"></script>
    -->

    <script src="/js/lib/jquery.superslides.min.js"></script>

    <script src="/js/lib/jquery.bxslider.min.js"></script>
    <script src="/js/lib/jquery.mixitup.min.js"></script>
    <script src="/js/lib/jquery.backtotop.js"></script>
    <script src="/js/lib/jquery.carouFredSel-6.2.1-packed.js"></script>
    <script src="/js/lib/retina.min.js"></script>


    <!------------------------------------------------->

    <script src="/bootstrap-table/src/bootstrap-table.js"></script>
    <script src="/bootstrap-table/src/bootstrap-table-mobile.js"></script>
    <script src="/ga.js"></script>
    <script type="text/javascript" src="plupload/js/plupload.full.min.js"></script>
    <script type="text/javascript" src="plupload/js/i18n/zh_CN.js"></script>



</head>

<body data-spy="scroll">

    <!-- Preloader -->
    <div id="preloader">
        <div id="status"></div>
    </div>
	
    <div id="main-wrapper">
        
        <!-- Site Navigation -->
        <div id="menu">
            <nav class="navbar navbar-default" role="navigation">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <!--
                    <a class="navbar-brand" href="index.html#">
                        <img src="images/logo.png" alt="logo">
                    </a>
                    -->
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li class="active"><a class="sscroll" href="index.html#home">Home</a></li>
                        <li><a class="sscroll" href="index.html#services">Services</a></li>
                             </ul>
                </div>
                <!-- /.navbar-collapse -->
            </nav>
        </div>
        
        <div id="container">
            <!-- BEGIN HOME -->
            <section id="home" class="home">
                <!-- Superslides -->

                <div id="home-slide">

                    <ul class="slides-container text-center " >

                        <li>
                            <div class="slide-text">
                                <h2>Built With Bootstrap</h2>
                                <span>Most popular HTML, CSS, and JS framework for developing responsive, mobile first projects</span>
                                <br/>
                            </div>
                            <div class="slide-filter"></div>

                            <img src="images/slider/22_new.jpg" class="par" alt="first" >

                        </li>
                        <li>
                            <div class="slide-text">
                                <h2>Fullscreen Slider</h2>
                                <span>Superslides - A fullscreen, hardware accelerated slider for jQuery</span>
                                <br/>
                            </div>
                            <div class="slide-filter"></div>
                            <img src="images/slider/11_new.jpg" class="par" alt="first">
                        </li>
                        <li>
                            <div class="slide-text">
                                <h2>Elegant Design</h2>
                                <span>We focused on usability of the template and combined useful content blocks based on that</span>
                                <br/>
                            </div>
                            <div class="slide-filter"></div>
                            <img src="images/slider/3_other.jpg" class="par" alt="first">
                        </li>

                    </ul>
                    <nav class="slides-navigation slidez">
                        <a href="javascript:;" class="next">
                            <i class="fa fa-angle-right"></i>
                        </a>
                        <a href="javascript:;" class="prev">
                            <i class="fa fa-angle-left"></i>
                        </a>
                    </nav>
                </div>

                <!-- End of Superslide -->

            </section>
            <!-- END HOME -->

            <!-- BEGIN SERVICES -->
            <section id="services" class="blog-front gray">
                <!--
                <h1>Bootstrap Table Examples <a href="https://github.com/wenzhixin/bootstrap-table-examples" class="btn btn-primary" role="button" target="_blank">Learn more &raquo;</a></h1>
                -->
                <h1>Plan Summary</h1>

                    <div id="toolbar">
                            <button id="create" class="btn btn-success btn-space">
                                <i class="glyphicon glyphicon-ok"></i> Create
                            </button>

                            <button id="pickfiles" class="btn btn-success btn-space" >
                                <i class="glyphicon glyphicon-plus"></i> SelectFile
                            </button>
                    </div>

                    <table
                           class="table table-striped thead-inverse "
                           id="table_wd"
                           data-toolbar="#toolbar"
                           data-search="true"
                           data-show-refresh="true"
                           data-show-toggle="true"
                           data-show-columns="true"
                           data-show-export="true"
                           data-detail-view="true"
                           data-detail-formatter="detailFormatter"
                           data-id-field="id"
                           data-pagination="true"
                           data-page-size= 100
                           data-page-list= "[5, 10, 25, 50, 100, 200]"
                           data-show-footer="false">

                        <!--
                        data-toggle="table"
                        data-url="/data.json"
                        data-minimum-count-columns="2"
                        data-show-pagination-switch="true"
                        data-pagination="true"
                        data-url="/examples/bootstrap_table/data.json"
                        data-side-pagination="server"
                        data-response-handler="responseHandler"
                        -->
                    </table>


                    <div class="modal fade" id="editMemberModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">Modal table</h4>
                                </div>
                                <div class="modal-body">
                                    <!-- output data here-->
                                </div>
                                <div class="modal-footer">
                                    <button id="updateToDb" type="button" class="btn btn-default" data-dismiss="modal">Save</button>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal-dialog -->
                    </div><!-- /.modal -->

                    <div class="modal fade" id="createMemberModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">Modal table</h4>
                                </div>
                                <div class="modal-body">
                                    <!-- output data here-->
                                </div>
                                <div class="modal-footer">
                                    <button id="addToDb" type="button" class="btn btn-default" data-dismiss="modal">Save</button>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal-dialog -->
                    </div><!-- /.modal -->

            </section>
            <!-- END SERVICES -->

        </div>
    </div>


    <!-- Back to top -->
    <div id="backtotop">       
        <a class="to-top-btn sscroll" href="index.html#home"><i class="fa fa-angle-double-up"></i></a>
    </div>




    <!--original js-->
    <script>
        var $table = $('#table_wd'),
            $remove = $('#remove'),
            $create = $('#create'),
            $addToDb = $('#addToDb'),
            $updateToDb = $('#updateToDb'),
            selections = [];

        //20170108
        //var Domain =  '7xqqm5.com1.z0.glb.clouddn.com';    // 七牛子域名，自定义域名。
        var Domain =  'oin5dqv2h.bkt.clouddn.com';
        var token,uploader;

        var mytestdata = [
            {
                "id": 1,
                "name": "test111",
                "price": "$12.20"
            },
            {
                "id": 2,
                "name": "test222",
                "price": "$3.00"
            },
            {
                "id": 3,
                "name": "test333",
                "price": "$27.90"
            }
        ];

        function getIdSelections() {
            return $.map($table.bootstrapTable('getSelections'), function (row) {
                return row.id
            });
        }
        /*
         function responseHandler(res) {
         $.each(res.rows, function (i, row) {
         row.state = $.inArray(row.id, selections) !== -1;
         });
         return res;
         }
         */

        function detailFormatter(index, row) {
            var html = [];
            $.each(row, function (key, value) {
                html.push('<p><b>' + key + ':</b> ' + value + '</p>');
            });
            return html.join('');
        }

        function linkFormatter(value, row, index) {
            if (row.link == null){
                return "";
            }


            var n = row.link.lastIndexOf("/");
            var shortLink = row.link.substr(n+1);
            return "<a href='" + row.link + "'>" + shortLink + "</a>";
        }

        function descriptionFormatter(value, row, index) {
            if (row.description == null){
                return "";
            }
            var shortDescription = "";

            if (row.description.length > 15){
                shortDescription = row.description.substr(0, 15);
            }
            else{
                shortDescription = row.description;
            }

            return shortDescription;
        }

        function operateFormatter(value, row, index) {
            return [
                /* 20170108
                 <a href="#" id="pickfiles" class="btn btn-default btn-lg " style="margin:10px 0px 0px 10px;">
                 <i class="glyphicon glyphicon-plus"></i>
                 <span>Select</span>
                 </a>
                 */

                /*
                '<a class="like" href="javascript:void(0)" title="Select">',
                '<i class="glyphicon glyphicon-heart"></i>',
                '</a>  ',
                '<a class="removeRow" href="javascript:void(0)" title="Remove">',
                '<i class="glyphicon glyphicon-remove"></i>',
                '</a>',
                */
                '<button class="wdtestedit btn btn-success btn-space btn-xs" data-toggle="viewMemberModal" data-target="#viewMemberModal"><span class="glyphicon glyphicon-edit"></span>Edit</button>',
                '<button class="wdtestedit_3 btn btn-success btn-space btn-xs" data-toggle="viewMemberModal" data-target="#viewMemberModal"><span class="glyphicon glyphicon-plus"></span>Select</button>',
                '<button class="wdtestedit_2 btn btn-success btn-space btn-xs" data-toggle="viewMemberModal" data-target="#viewMemberModal"><span class="glyphicon glyphicon-upload"></span>Upload</button>'

                //20170108
                /*
                '<a href="#" class="wdtestedit_3 btn btn-success btn-space" >',
                '<i class="glyphicon glyphicon-plus"></i>',
                '<span>Select</span>',
                '</a>',

                '<a href="#" class="wdtestedit_2 btn btn-success btn-space" >',
                '<i class="glyphicon glyphicon-upload"></i>',
                '<span>Upload</span>',
                '</a>'
                */
                //'<button class="wdtestedit_2 btn btn-success btn-space" ><i class="glyphicon glyphicon-upload"></i><span>Upload</span>></button>'
            ].join('');
        }

        window.operateEvents = {
            'click .like': function (e, value, row, index) {
                alert('You click like action, row: ' + JSON.stringify(row));
            },

            'click .wdtestedit':showEditModal,


            'click .wdtestedit_2':uploadFiles,

            'click .wdtestedit_3':selectFiles,

            /*
             'click .wdtestedit': function (e, value, row, index) {
             //alert('You click edit, row: ' + JSON.stringify(row));

             //$('#viewMemberModal').modal('show')
             //       .find('.modal-body').html('<pre>' +
             //       JSON.stringify(row, null, 4) + '</pre>');

             var modalBody = $('<div id="modalContent"></div>');
             var modalForm = $('<form role="form" name="modalForm" action="putYourPHPActionHere.php" method="post"></form>');
             $.each(row, function(columnName, columnValue) {
             var formGroup = $('<div class="form-group"></div>');
             formGroup.append('<label>'+ columnName + '</label>');
             formGroup.append('<input class="form-control" name="'+ columnName + '" id="' + columnName + '" value="' + columnValue + '" />');
             modalForm.append(formGroup);
             });
             modalBody.append(modalForm);
             $('#viewMemberModal').modal('show')
             .find('.modal-body').html(modalBody);

             },
             */


            'click .removeRow': deleteDataToDb

            /*
             'click .removeRow': function (e, value, row, index) {
             $table.bootstrapTable('remove', {
             field: 'id',
             values: [row.id]
             });
             }
             */
        };




        function showEditModal(e, value, row, index) {
            //alert('You click edit, row: ' + JSON.stringify(row));

            //$('#viewMemberModal').modal('show')
            //       .find('.modal-body').html('<pre>' +
            //       JSON.stringify(row, null, 4) + '</pre>');

            var modalBody = $('<div id="modalContent"></div>');
            var modalForm = $('<form role="form" name="modalForm" action="putYourPHPActionHere.php" method="post"></form>');
            $.each(row, function(columnName, columnValue) {

                var formGroup = $('<div class="form-group"></div>');

                if (columnName == 'link' && columnValue == null){
                    return;
                }

                formGroup.append('<label>'+ columnName + '</label>');

                if (columnName != 'id'){
                    formGroup.append('<input class="form-control" name="'+ columnName + '" id="' + columnName + '" value="' + columnValue + '" />');
                } else{
                    formGroup.append('<input class="form-control" name="'+ columnName + '" id="' + columnName + '" value="' + columnValue + '" disabled />');
                }
                modalForm.append(formGroup);
            });
            modalBody.append(modalForm);
            $('#editMemberModal').modal('show')
                    .find('.modal-body').html(modalBody);

        }

        function showCreateModal(row) {
            var modalBody = $('<div id="modalContent"></div>');
            var modalForm = $('<form role="form" name="modalForm" action="putYourPHPActionHere.php" method="post"></form>');
            $.each(row, function(columnName, columnValue) {
                var formGroup = $('<div class="form-group"></div>');
                formGroup.append('<label>'+ columnName + '</label>');
                formGroup.append('<input class="form-control" name="'+ columnName + '" id="' + columnName + '" value="' + columnValue + '" />');
                modalForm.append(formGroup);
            });
            modalBody.append(modalForm);
            $('#createMemberModal').modal('show')
                    .find('.modal-body').html(modalBody);

        }

        function totalTextFormatter(data) {
            return 'Total';
        }

        function totalNameFormatter(data) {
            return data.length;
        }

        function totalPriceFormatter(data) {
            var total = 0;
            $.each(data, function (i, row) {
                total += +(row.price.substring(1));
            });
            return '$' + total;
        }

        function getHeight() {
            return $(window).height() - $('h1').outerHeight(true);
        }

        function getScript(url, callback) {
            var head = document.getElementsByTagName('head')[0];
            var script = document.createElement('script');
            script.src = url;

            var done = false;
            // Attach handlers for all browsers
            script.onload = script.onreadystatechange = function() {
                if (!done && (!this.readyState ||
                        this.readyState == 'loaded' || this.readyState == 'complete')) {
                    done = true;
                    if (callback)
                        callback();

                    // Handle memory leak in IE
                    script.onload = script.onreadystatechange = null;
                }
            };

            head.appendChild(script);

            // We handle everything using the script element injection
            return undefined;
        }
        /*
         $("[data-target=#myModal]").click(function() {
         var columnHeadings = $("thead th").map(function() {
         return $(this).text();
         }).get();
         columnHeadings.pop();
         var columnValues = $(this).parent().siblings().map(function() {
         return $(this).text();
         }).get();
         var modalBody = $('<div id="modalContent"></div>');
         var modalForm = $('<form role="form" name="modalForm" action="putYourPHPActionHere.php" method="post"></form>');
         $.each(columnHeadings, function(i, columnHeader) {
         var formGroup = $('<div class="form-group"></div>');
         formGroup.append('<label for="'+columnHeader+'">'+columnHeader+'</label>');
         formGroup.append('<input class="form-control" name="'+columnHeader+i+'" id="'+columnHeader+i+'" value="'+columnValues[i]+'" />');
         modalForm.append(formGroup);
         });
         modalBody.append(modalForm);
         $('.modal-body').html(modalBody);
         });
         */

        $('.modal-footer .btn-primary').click(function() {
            $('form[name="modalForm"]').submit();
        });

        //==========================================

        function getAjaxDataFromDbAndInitTable(){
            $.ajax({
                url: '/todo',
                dataType: 'json',
                success: function(data) {
                    console.log(data);
                    initTable(data);
                },
                error: function(e) {
                    console.log(e.responseText);
                }
            });
        }

        function getAjaxDataFromDbAndUpdateTable(){
            $.ajax({
                url: '/todo',
                dataType: 'json',
                success: function(data) {
                    console.log(data);
                    updateTableData(data);
                },
                error: function(e) {
                    console.log(e.responseText);
                }
            });
        }

        function addNewDataToDb(submitedData){
            $.ajax({
                url: '/todo',
                dataType: 'json',
                type:'post',
                data:submitedData,
                success: function(data) {
                    console.log(data);
                    getAjaxDataFromDbAndUpdateTable();
                },
                error: function(e) {
                    console.log(e.responseText);
                }
            });
        }

        function updateDataToDb(submitedData){
            $.ajax({
                url: '/todo',
                dataType: 'json',
                type:'put',
                data:submitedData,
                success: function(data) {
                    console.log(data);
                    getAjaxDataFromDbAndUpdateTable();
                },
                error: function(e) {
                    console.log(e.responseText);
                }
            });
        }

        function deleteDataToDb(e, value, row, index){
            $.ajax({
                url: '/todo/' + row.id,
                dataType: 'json',
                type:'delete',
                success: function(data) {
                    console.log(data);
                    getAjaxDataFromDbAndUpdateTable();
                },
                error: function(e) {
                    console.log(e.responseText);
                }
            });
        }

        function updateTableData(data)
        {
            //$table.bootstrapTable("destroy");
            $table.bootstrapTable("load", data);
        }

        function initTable(data) {

            $table.bootstrapTable({
                height: getHeight(),
                columns: [
                    {
                        title: 'ID',
                        field: 'id',
                        align: 'center',
                        valign: 'middle',
                        sortable: true,
                        width: '10%',
                        footerFormatter: totalTextFormatter
                    },
                    {
                        field: 'time',
                        title: 'Time',
                        sortable: true,
                        width: '10%',
                        align: 'center'
                    },
                    {
                        field: 'name',
                        title: 'Name',
                        sortable: true,
                        width: '10%',
                        footerFormatter: totalNameFormatter,
                        align: 'center'
                    },
                    {
                        field: 'description',
                        title: 'Description',
                        sortable: false,
                        align: 'center',
                        width: '25%',
                        formatter: descriptionFormatter,
                        footerFormatter: totalPriceFormatter
                    },
                    {
                        field: 'link',
                        title: 'Video',
                        sortable: false,
                        formatter: linkFormatter,
                        footerFormatter: totalNameFormatter,
                        width: "15%",
                        align: 'center'
                    },
                    {
                        title: 'Operate',
                        align: 'center',
                        events: operateEvents,
                        width: '30%',
                        class: 'operateColumn',
                        formatter: operateFormatter
                    }
                ],
                /*
                 columns: [
                 [
                 {
                 title: 'ID',
                 field: 'id',
                 rowspan: 2,
                 align: 'center',
                 valign: 'middle',
                 sortable: true,
                 footerFormatter: totalTextFormatter
                 }, {
                 title: 'Plan Detail',
                 colspan: 5,
                 align: 'center'
                 }
                 ],
                 [
                 {
                 field: 'time',
                 title: 'Time',
                 sortable: true,
                 align: 'center'
                 },                    {
                 field: 'name',
                 title: 'Name',
                 sortable: true,
                 footerFormatter: totalNameFormatter,
                 align: 'center'
                 }, {
                 field: 'description',
                 title: 'Description',
                 sortable: false,
                 align: 'center',
                 footerFormatter: totalPriceFormatter
                 }, {
                 field: 'link',
                 title: 'Video',
                 sortable: false,
                 formatter: linkFormatter,
                 footerFormatter: totalNameFormatter,
                 align: 'center',
                 } , {
                 title: 'Operate',
                 align: 'center',
                 events: operateEvents,
                 formatter: operateFormatter
                 }
                 ]
                 ],
                 */
                data: data
                /*
                 columns: [

                 {
                 title: 'Item ID',
                 field: 'id',
                 align: 'center',
                 valign: 'middle',
                 sortable: true,
                 footerFormatter: totalTextFormatter
                 }
                 ]
                 */
            });

            // sometimes footer render error.
            setTimeout(function () {
                $table.bootstrapTable('resetView');
            }, 200);
            $table.on('check.bs.table uncheck.bs.table ' +
                    'check-all.bs.table uncheck-all.bs.table', function () {
                $remove.prop('disabled', !$table.bootstrapTable('getSelections').length);

                // save your data, here just save the current page
                selections = getIdSelections();
                // push or splice the selections if you want to save all data selections
            });

            /*
             $table.on('expand-row.bs.table', function (e, index, row, $detail) {
             if (index % 2 == 1) {
             $detail.html('Loading from ajax request...');
             $.get('LICENSE', function (res) {
             $detail.html(res.replace(/\n/g, '<br>'));
             });
             }
             });
             $table.on('all.bs.table', function (e, name, args) {
             console.log(name, args);
             });
             */

            $remove.click(function () {
                var ids = getIdSelections();
                $table.bootstrapTable('remove', {
                    field: 'id',
                    values: ids
                });
                $remove.prop('disabled', true);
            });

            $create.click(function () {
                var rowMock = {time: "", name: "", description: "" };
                showCreateModal(rowMock);
            });

            $addToDb.click(function () {
                var submitedData = {
                    //id: $("#id").val(),
                    time:$("#time").val(),
                    name:$("#name").val(),
                    description:$("#description").val()
                };

                addNewDataToDb(submitedData);

            });

            $updateToDb.click(function () {

                var submitedData;
                if ($("#link").length > 0){
                    submitedData = {
                        id: $("#id").val(),
                        time: $("#time").val(),
                        name:$("#name").val(),
                        description:$("#description").val(),
                        link:$("#link").val()
                    };
                }
                else{
                    submitedData = {
                        id: $("#id").val(),
                        time: $("#time").val(),
                        name:$("#name").val(),
                        description:$("#description").val()
                    };
                }


                updateDataToDb(submitedData);

            });

            $(window).resize(function () {
                $table.bootstrapTable('resetView', {
                    height: getHeight()
                });
            });

            //20170108
            initPlupload();

        }

        //20170108

        function selectFiles(){
            $("#pickfiles").click();
        }


        var dataSubmitWithLink = {};

        function uploadFiles(e, value, row, index){
            if(uploader.files.length == 0) {
                //jAlert("请添加需要上传的文件！", "提示");
                alert("no file selected!");
            }
            else{
                alert("start upload!");
                uploader.start(); //调用实例对象的start()方法开始上传文件，当然你也可以在其他地方调用该方法
                dataSubmitWithLink = {
                    id: row.id,
                    time: row.time,
                    name: row.name,
                    description: row.description,
                    link: null
                };
            }


        }

        //20170108
        function initPlupload(){
            //实例化一个plupload上传对象
            uploader = new plupload.Uploader({
                runtimes: 'html5,flash,html4',
                browse_button : 'pickfiles', //触发文件选择对话框的按钮，为那个元素id
                url: 'https://upload.qiniu.com/',  // 服务器上传地址
                unique_names: true,
                multipart: true,
                multipart_params: {},     // 后续设置该从参数的值
            });

            //在实例对象上调用init()方法进行初始化
            uploader.init();

            // 当上传队列中的某一文件正要开始上传前触发
            uploader.bind('BeforeUpload', function(uploader, files){
                // 设置当前上传文件名和token
                uploader.setOption('multipart_params', {
                    token: token,
                    'key': files.name,        // 设置key，key即为存放在云上的文件名
                });
            });

            /*
             // 当文件添加到上传队列后触发,files为一数组（本次添加的文件对象数组）
             uploader.bind('FilesAdded',function(uploader, files){
             var html = '';
             for(var i=0; i<files.length; i++) {
             console.log('files_name___:');
             console.log(files[i].name);
             html = '<tr data-file_name="'+files[i].name+'">'
             +'<td>'+files[i].name+'</td>'
             +'<td>'+files[i].size+'B'+'</td>'
             +'<td>'+'未上传'+'</td>'
             +'<td>请上传</td>'
             '</tr>';
             $('#file-info tbody').append(html);
             }
             });
             */

            // 文件上传出错时触发
            uploader.bind('Error',function(uploader,errObject){
                console.log("error___:");
                console.log(errObject);
                //jAlert(""+eval("("+errObject.response+")").error+"", "提示");
                //var key = errObject.file.name;
                //$("tr[data-file_name='"+key+"']").find('td:eq(2)').text('上传失败！');
            });

            // 文件上传完成后触发,也就是文件上传成功
            uploader.bind('FileUploaded',function(uploader, file, responseObject){
                var htmlStr;
                console.log("responseObject___:");
                console.log(responseObject);
                var key = JSON.parse(responseObject.response).key;
                console.log(key);

                var downLoadLink = "http://" + Domain + "/" + key;
                console.log(downLoadLink);


                //upload success, we need put the download link to MySql database

                dataSubmitWithLink.link = downLoadLink;
                updateDataToDb(dataSubmitWithLink);

                /*
                 // 如果文件是图片，则添加预览和下载功能（默认上传的资源为公有资源，私有资源必须通过手动设置）
                 if(isImage(key)) {
                 htmlStr = '<img alt="" src="http://'+Domain+'/'+key+'" width="100" height="100" class="materialboxed">';
                 // 找到当前列
                 $("tr[data-file_name='"+key+"']").find('td:eq(3)').text('').append(htmlStr);
                 }else{   // 如果不是，则添加下载功能
                 htmlStr = '<a type="button" class="btn btn-primary" href="http://'+Domain+'/'+key+'">下载</a>';
                 $("tr[data-file_name='"+key+"']").find('td:eq(3)').text('').append(htmlStr);
                 }
                 */
            });

            // 当当前上传文件队列中的所有文件都已上传完时触发
            uploader.bind('UploadComplete',function(uploader,file){
                /*
                 // 修改表格状态
                 $('#file-info tbody tr').each(function(index, ele){
                 var text = $(this).find('td:eq(2)').text();
                 if(text == '未上传') {
                 $(this).find('td:eq(2)').text('已上传');
                 }
                 });
                 */
                // 清空文件队列
                file.length = 0 ;

                //$('.materialboxed').materialbox();
            });

            /*
             //最后给"开始上传"按钮注册事件
             document.getElementById('start_upload').onclick = function(){
             // 查看文件队列中是否有文件已被选中 TODO
             if(uploader.files.length == 0) {
             jAlert("请添加需要上传的文件！", "提示");
             }
             uploader.start(); //调用实例对象的start()方法开始上传文件，当然你也可以在其他地方调用该方法
             }
             */
        }


        $(function () {
            //$('#pickfiles').hide();
            getAjaxDataFromDbAndInitTable();

            /*
             var scripts = [
             location.search.substring(1) || 'assets/bootstrap-table/src/bootstrap-table.js',
             'assets/bootstrap-table/src/extensions/export/bootstrap-table-export.js',
             'http://rawgit.com/hhurz/tableExport.jquery.plugin/master/tableExport.js',
             'assets/bootstrap-table/src/extensions/editable/bootstrap-table-editable.js',
             'http://rawgit.com/vitalets/x-editable/master/dist/bootstrap3-editable/js/bootstrap-editable.js'
             ],
             eachSeries = function (arr, iterator, callback) {
             callback = callback || function () {};
             if (!arr.length) {
             return callback();
             }
             var completed = 0;
             var iterate = function () {
             iterator(arr[completed], function (err) {
             if (err) {
             callback(err);
             callback = function () {};
             }
             else {
             completed += 1;
             if (completed >= arr.length) {
             callback(null);
             }
             else {
             iterate();
             }
             }
             });
             };
             iterate();
             };

             eachSeries(scripts, getScript, initTable);
             */

            //20170108
            // 获取上传凭证,token的有效时间是一小时
            function getToken() {
                $.ajax({
                    type: 'GET',
                    url: 'api/fileupload/uptoken',
                    dataType: 'json',
                    success: function (data) {
                        token = data.uptoken;
                    }
                });
            }

            /*
             * 该实例为直接上传文件，不分块，
             1、业务服务器生成 uptoken（不设置回调，自己回调到自己这里没有意义）
             2、凭借 上传凭证 上传文件到七牛
             3、善后工作，比如保存相关的一些信息
             */

            // 获取token
            getToken();
        });



    </script>

</body>

</html>
